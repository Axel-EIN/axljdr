
<article id="scn{{ une_scene.numero }}" class="relative">

    <!-- CONTENEUR IMAGE DE LA SCENE -->
    <div class="bg-black relative">

        <!-- par dessus BOUTON D'EDITION POUR MJ -->
        {% if app.user and is_granted("ROLE_MJ") %}
            <a class="text-light-alpha btn-icon-medium position-icon-edit" href="{{path('admin_scene_edit',{id:une_scene.id})}}?redirect=episode">
                <i class="fas fa-edit"></i>
            </a>
        {% endif %}

        <!-- par dessus ICON TEMPS et ICON LIEU -->
        <div class="time-and-location-line">

            <span class="hover-tooltip">
                {% if une_scene.lieu is not empty %}{{une_scene.lieu.nom}}, {% endif %}{{une_scene.temps|default('Temps inconnu')}}
            </span>

            <div class="location">
                {% if une_scene.lieu is not empty %}
                    <a href="{{path('empire_lieu', {id: une_scene.lieu.id} ) }}" >
                {% endif %}
                    <img src="{{asset(une_scene.lieu.icone|default(NA_LIEU_ICO))}}" alt="icône du lieu" />
                {% if une_scene.lieu is not empty %}
                    </a>
                {% endif %}
            </div>

            <div class="time" >
                {% if une_scene.temps == 'Aube' or une_scene.temps == 'Matinée' %}
                    {% set TIME_ICO = MORNING %}
                {% elseif une_scene.temps == 'Midi' or une_scene.temps == 'Après-midi' or une_scene.temps == 'Journée' %}
                    {% set TIME_ICO = NOON %}
                {% elseif une_scene.temps == 'Soirée' or une_scene.temps == 'Crépuscule' or une_scene.temps == 'Tombée de la nuit' %}
                    {% set TIME_ICO = EVENING %}
                {% elseif une_scene.temps == 'Minuit' or une_scene.temps == 'Nuit' %}
                    {% set TIME_ICO = NIGHT %}
                {% elseif une_scene.temps == 'Intemporel' %}
                    {% set TIME_ICO = INTEMPOREL %}
                {% endif %}
                <img src="{{asset(TIME_ICO|default(NA_TIME))}}" alt="icône du temps" />
            </div>
            
        </div>

        <!-- PAR DESSUS LIGNE DE PNJS -->
        <div class="characters-line pnjs">
            {% for une_participation in une_scene.participations %}
                {% if une_participation.estPj == 0 %}
                    {% if une_participation.personnage.icone is null and une_participation.personnage.genre == 'F' %}
                        {% set NA_PERSO_ICO = NA_PERSO_ICO_F %}
                    {% elseif une_participation.personnage.icone is null and une_participation.personnage.genre == 'M' %}
                        {% set NA_PERSO_ICO = NA_PERSO_ICO_M %}
                    {% endif %}
                    <character class="character-portrait-box">
                        <a class="character-portrait-link" href="{{path('personnage_profil',{id: une_participation.personnage.id})}}" >
                            {% if une_participation.estMort == 1 %}
                                <img class="character-icon-dead" src="{{asset('assets/img/icons/mort.png')}}" alt="est mort" />
                            {% endif %}
                            <span class="hover-tooltip character-name pnj">
                                {{une_participation.personnage.prenom}}
                            </span>
                            <img class="character-portrait large pnj
                                {% if une_participation.estMort == 1 %} dead{% endif %}"
                                src="{{asset(une_participation.personnage.icone|default(NA_PERSO_ICO))}}"
                                alt="Icone personnage" />
                        </a>
                    </character>
                {% endif %}
            {% endfor %}
        </div>

        <!-- PAR DESSUS LIGNE DE PJS -->
        <div class="characters-line pjs">
            {% for une_participation in une_scene.participations|sort( (a, b) => a.xpGagne <=> b.xpGagne)|reverse %}
                {% if une_participation.estPj %}

                    {% if une_participation.icone is not defined and une_participation.genre is defined and une_participation.genre == 'F' %}
                        {% set NA_PERSO_ICO = NA_PERSO_ICO_F %}
                    {% elseif une_participation.icone is not defined and une_participation.genre is defined and une_participation.genre == 'M' %}
                        {% set NA_PERSO_ICO = NA_PERSO_ICO_M %}
                    {% endif %}

                    <character class="character-portrait-box">
                        {% if une_participation.xpGagne != 0 and une_participation.estMort != 1 %}
                            <strong class="{% if une_participation.personnage.joueur == app.user %}text-your-xp{% else %}text-xp{% endif %}">
                                <strong class="text-medium">+{{une_participation.xpGagne}}</strong> <span class="text-small">XP</span>
                            </strong><br/>
                        {% endif %}
                        <a class="character-portrait-link" href="{{path('personnage_profil',{id:une_participation.personnage.id})}}" >
                            {% if une_participation.estMort == 1 %}
                                <img class="character-icon-dead" src="{{asset('assets/img/icons/mort.png')}}" alt="est mort" />
                            {% endif %}
                            <span class="hover-tooltip character-name pj {% if une_participation.personnage.joueur == app.user %}me{% endif %} {% if une_participation.xpGagne == 0 or une_participation.estMort == 1 %}gray{% endif %}">
                                {{une_participation.personnage.prenom}}
                            </span>
                            <img
                                class="character-portrait large pj 
                                {% if une_participation.personnage.joueur == app.user %} me outlined{% endif %}
                                {% if une_participation.estMort == 1 %} dead{% elseif une_participation.xpGagne == 0 %}grayscale{% endif %}"
                                src="{{asset(une_participation.personnage.icone|default(NA_PERSO_ICO))}}"
                                alt="Icone personnage" />
                        </a>
                    </character>
                {% endif %}
            {% endfor %}
        </div>

        <!-- CONTENEUR REDIMENSIONNEUR DE RATIO AVEC L'IMAGE À L'INTERIEUR -->
        <div class="ratio-169 gradient-after">
            <img class="ratio-cropped" src="{{ asset(une_scene.image|default(NA_SCENE)) }}"  alt="Image d'une scène">
        </div>
        

    </div>

    <div class="card-body scene-body relative mb-2">

        <!-- TITRE SCENE -->
        <div class="absolute scene-title-container">
            <h3 class="card-title">{{ une_scene.titre }}</h3>
        </div>

        <!-- TEXTE RESUME DE LA SESSION -->
        <p class="card-text scene-text text-justify">{{ une_scene.texte|raw|nl2br }}</p>

    </div>

    {% if app.user and is_granted("ROLE_MJ") %}
        {% set color, element, un_element, redirect = 'text-accent', 'scene', une_scene, 'episode' %}
        <div class="d-flex justify-content-center">

            <!-- MJ BTN ICON+TEXT Edit -->
            <div class="mr-5">
            {% set action = 'edit' %}
            {{ include('/parts/btn-line.html.twig') }}
            </div>
            
            <!-- MJ BTN ICON+TEXT Delete -->
            <div class="ml-5">
            {% set action = 'delete' %}
            {{ include('/parts/btn-line.html.twig') }}
            </div>

        </div>

    {% endif %}

    {{ include('/parts/separateur-ornament.html.twig') }}

</article>
<!-- FIN : UNE SCENE -->